# portforward postgres from the cluster to use in localhost dev/testing
```
k port-forward -n tasks svc/tasks-postgres-master

# get the password from a secret generated by postgres operator:
# kubectl get secret app-user.tasks-postgres.credentials.postgresql.acid.zalan.do -n tasks -o 'jsonpath={.data.password}' | base64 -d

export POSTGRES_CONNECTION="host=localhost port=5432 user=app-user dbname=tasks password=<password> sslmode=disable"

# connect with psql:
psql -h localhost -p 5432 -U app-user -d tasks

# install dependencies:
go get .

# build and run app
go build
./leet

# build  and run canary
cd canary
go build
./canary

# build container images
docker build -f <docker file> -t <tag> .
```

## TODO:

#### On app repo merge request (also have a script.sh that can do this all locally, and pre-commit):
1. Build code and Docker image
2. Test Container (maybe parallel tests)
3. Use kustomize or helm to generate manifests for each environment with the @hash of the docker image
   And verify that the generated manifests match the pre-commit generated manifests
4. Push container

#### On app repo merge:
1. Make merge request to infra repository to update the image @hash


#### Also TODO:
1. Need to get canary working (it doesn't like the self-signed certs)
2. Integration tests just set up a local server, and call the canary client on it, and verify no panics
3. Canary runs every 30s and exports prometheus metrics on port 9000
4. Need to get tasks by id
5. Need to get a notion of "users/accounts" and have the canary account only see its own data and clean up after itself
